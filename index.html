<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BART Status</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center mb-4">BART Status</h1>

    <!-- Elevator Status Section -->
    <div id="elevatorStatusContainer" class="mb-4">
      <h2>Elevator Status:</h2>
      <p>Loading...</p>
      <button onclick="fetchElevatorStatus()" class="btn btn-primary mt-3">Refresh Elevator Status</button>
    </div>

    <!-- Train Departures Section -->
    <div>
      <h2 class="mb-3">Check Real-Time Departures</h2>
      <label for="stationSelect" class="form-label">Select a BART Station:</label>
      <select id="stationSelect" class="form-select mb-4" onchange="fetchDepartures(this.value)">
        <option value="">Select a station...</option>
        <option value="12TH">12th St. Oakland City Center</option>
        <option value="16TH">16th St. Mission (SF)</option>
        <option value="19TH">19th St. Oakland</option>
        <option value="24TH">24th St. Mission (SF)</option>
        <option value="ASHB">Ashby (Berkeley)</option>
        <option value="ANTC">Antioch</option>
        <option value="BALB">Balboa Park (SF)</option>
        <option value="BAYF">Bay Fair (San Leandro)</option>
        <option value="BERY">Berryessa / North San Jose</option>
        <option value="CAST">Castro Valley</option>
        <option value="CIVC">Civic Center (SF)</option>
        <option value="COLS">Coliseum</option>
        <option value="COLM">Colma</option>
        <option value="CONC">Concord</option>
        <option value="DALY">Daly City</option>
        <option value="DBRK">Downtown Berkeley</option>
        <option value="DUBL">Dublin/Pleasanton</option>
        <option value="DELN">El Cerrito del Norte</option>
        <option value="PLZA">El Cerrito Plaza</option>
        <option value="EMBR">Embarcadero (SF)</option>
        <option value="FRMT">Fremont</option>
        <option value="FTVL">Fruitvale (Oakland)</option>
        <option value="GLEN">Glen Park (SF)</option>
        <option value="HAYW">Hayward</option>
        <option value="LAFY">Lafayette</option>
        <option value="LAKE">Lake Merritt (Oakland)</option>
        <option value="MCAR">MacArthur (Oakland)</option>
        <option value="MLBR">Millbrae</option>
        <option value="MLPT">Milpitas</option>
        <option value="MONT">Montgomery St. (SF)</option>
        <option value="NBRK">North Berkeley</option>
        <option value="NCON">North Concord/Martinez</option>
        <option value="OAKL">Oakland Int'l Airport</option>
        <option value="ORIN">Orinda</option>
        <option value="PITT">Pittsburg/Bay Point</option>
        <option value="PCTR">Pittsburg Center</option>
        <option value="PHIL">Pleasant Hill</option>
        <option value="POWL">Powell St. (SF)</option>
        <option value="RICH">Richmond</option>
        <option value="ROCK">Rockridge (Oakland)</option>
        <option value="SBRN">San Bruno</option>
        <option value="SFIA">San Francisco Int'l Airport</option>
        <option value="SANL">San Leandro</option>
        <option value="SHAY">South Hayward</option>
        <option value="SSAN">South San Francisco</option>
        <option value="UCTY">Union City</option>
        <option value="WARM">Warm Springs/South Fremont</option>
        <option value="WCRK">Walnut Creek</option>
        <option value="WDUB">West Dublin</option>
        <option value="WOAK">West Oakland</option>
      </select>

      <div id="departuresContainer"></div>
    </div>
  </div>

  <script>
    function fetchElevatorStatus() {
      const apiKey = "MW9S-E7SL-26DU-VV8V";
      const elevatorUrl = `https://api.bart.gov/api/bsa.aspx?cmd=elev&key=${apiKey}&json=y`;

      fetch(elevatorUrl)
        .then(response => response.json())
        .then(data => {
          const elevatorStatusContainer = document.getElementById('elevatorStatusContainer');
          const statusMessage = data.root.bsa[0].description['#cdata-section'];
          elevatorStatusContainer.innerHTML = `<h2>Elevator Status:</h2><p>${statusMessage}</p>`;
        })
        .catch(error => {
          console.error('Error fetching elevator status:', error);
          const elevatorStatusContainer = document.getElementById('elevatorStatusContainer');
          elevatorStatusContainer.innerHTML = `<h2>Elevator Status:</h2><p>Failed to retrieve elevator status.</p>`;
        });
    }

    function fetchDepartures(station) {
      const apiKey = "MW9S-E7SL-26DU-VV8V";
      const departuresUrl = `https://api.bart.gov/api/etd.aspx?cmd=etd&orig=${station}&key=${apiKey}&json=y`;

      fetch(departuresUrl)
        .then(response => response.json())
        .then(data => {
          const departuresContainer = document.getElementById('departuresContainer');
          const stationName = data.root.station[0].name;
          const etd = data.root.station[0].etd;

          if (etd && etd.length > 0) {
            let html = `<h3>Next Departures from ${stationName}</h3>`;
            html += '<ul>';
            etd.forEach(train => {
              html += `<li>${train.destination}: ${train.estimate[0].minutes} minutes</li>`;
            });
            html += '</ul>';
            departuresContainer.innerHTML = html;
          } else {
            departuresContainer.innerHTML = `<p>No departures available for ${stationName}</p>`;
          }
        })
        .catch(error => {
          console.error('Error fetching train departures:', error);
          const departuresContainer = document.getElementById('departuresContainer');
          departuresContainer.innerHTML = `<p>Failed to retrieve train departures.</p>`;
        });
    }

    // Fetch elevator status on page load
    window.addEventListener('load', fetchElevatorStatus);
  </script>
</body>
</html>
